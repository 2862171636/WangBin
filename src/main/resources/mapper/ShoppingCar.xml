<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.lanou.dao.ShoppingCarMapper">

    <resultMap type="ShoppingCar" id="ShoppingResult" >
    		<id column="shoppingCar_id" property="shoppingCarId" javaType="int"/>
			<result column="num" property="num" javaType="int"/>
			<result column="u_Id" property="uId" javaType="int"/>
			<association property="price" column="price_id"
					 select="com.lanou.dao.PriceMapper.selectPriceByPriceId"/>
    </resultMap>
	<parameterMap id="shoppingCar" type="ShoppingCar">
		<parameter property="shoppingCarId" javaType="int"/>
		<parameter property="priceId" javaType="int"/>
		<parameter property="num" javaType="int"/>
		<parameter property="uId" javaType="int"/>
		<parameter property="stockId" javaType="int"/>
	</parameterMap>

	<!--添加到购物车 通过页面传过来的属性 priceId num(数量) uId(当前用户)-->
	<insert id="addToShoppingCar" keyProperty="shoppingCarId" parameterMap="shoppingCar">
		INSERT INTO shoppingCar(price_id,num,u_id) VALUES (#{price_id},#{num},#{uId});SELECT @@Identity
	</insert>
	<!--显示当前用户添加到购物车的商品信息-->
	<select id="selectShoppingCarsForUser" resultMap="ShoppingResult" parameterType="int">
		SELECT * FROM shoppingCar WHERE 1=1 AND u_id = #{uid}
	</select>
	<!--从购物车删除 直接物理删除 但要求购物车对象未绑定订单(提交) 即order_id = 0 -->
	<delete id="deleteShoppingCarById" parameterType="int">
		DELETE * FROM shoppingCar WHERE 1=1 AND shoppingCarId= #{shoppingCarId},order_id = 0
	</delete>
	<!--编辑购物车信息 可以改变所选商品属性-->
	<update id="updateShoppingCar" parameterType="int">
		UPDATE (price_Id,num,stockId) VALUES (#{priceId},#{num},#{stockId}) WHERE shoppingCarId = #{shoppingCarId}
	</update>
	<!--当提交订单时 根据生成的订单orderId去改变购物车状态-->
	<update id="orderShoppingCar" parameterType="int">
		UPDATE (order_id) VALUES (#{orderId}) WHERE shoppingCarId = #{shoppingCarId} and order_Id = 0;
	</update>
	<!--当访问订单时 通过orderId加载出对应的订单信息 -->
	<select id="selectShoppingCarsForOrder" parameterType="int" resultMap="ShoppingResult">
		SELECT * FROM shoppingCar WHERE order_id = #{orderId}
	</select>
</mapper>
